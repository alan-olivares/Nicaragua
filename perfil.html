<!DOCTYPE html>
<html>
   <head>
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <title>TBRE</title>
      <link href="css/bootstrap.min.css" rel="stylesheet">
      <link href="font-awesome/css/font-awesome.css" rel="stylesheet">
      <link rel="icon" href="img\TBRE.ico">
      <link rel="stylesheet" href="css/jquery-ui.css">
      <link href="css/animate.css" rel="stylesheet">
      <link href="css/style.css" rel="stylesheet">
      <link rel="stylesheet" href="/resources/demos/style.css">
      <link href="css/plugins/sweetalert/sweetalert.css" rel="stylesheet">
   </head>
   <body>
      <script src="js/revisar_sesion.js"></script>
      <div id="wrapper">
         <nav class="navbar-default navbar-static-side" role="navigation">
            <div class="sidebar-collapse">
               <ul class="nav metismenu" id="side-menu">
                  <li class="nav-header">
                     <div class="dropdown profile-element">
                        <img alt="image" class="rounded-circle perfil" id="perfil1"/>
                        <a data-toggle="dropdown" class="dropdown-toggle" href="#">
                           <span class="block m-t-xs font-bold">
                              <script>
                                 document.write(localStorage['nombre'] || 'Sin nombre');
                                 var foto=localStorage['nombre'] || 'Sin nombre';
                                 foto=foto.charAt(0).concat(".png").toLowerCase();
                                 document.getElementById("perfil1").src="img/letras/"+foto;
                              </script>
                           </span>
                           <span class="text-muted text-xs block">
                              <script>
                                 document.write(localStorage['perfil'] || 'Sin perfil');
                              </script><b class="caret"></b>
                           </span>
                        </a>
                        <ul class="dropdown-menu animated fadeInRight m-t-xs">
                           <li><a class="dropdown-item" href="perfil.html">Perfil</a></li>
                           <li class="dropdown-divider"></li>
                           <li><a class="dropdown-item" onclick="limpiar();">Cerrar sesión</a></li>
                        </ul>
                     </div>
                     <div class="logo-element">
                        TBRE
                     </div>
                  </li>
                  <li>
                     <a href="index.php"><i class="fa fa-area-chart"></i> <span class="nav-label">Operación del día</span></a>
                  </li>
                  <li>
                     <a href="#"><i class="fa fa-table"></i> <span class="nav-label">Reportes</span><span class="fa arrow"></span></a>
                     <ul class="nav nav-second-level">
                        <li><a href="inventario.php">Inventario</a></li>
                        <li><a href="barriles_plantel.php">Barriles en plantel</a></li>
                        <li><a href="llenados.php">Barriles llenados</a></li>
                        <li><a href="rellenados.php">Barriles rellenados</a></li>
                        <li><a href="trasiego.php">Barriles trasegados</a></li>
                        <li><a href="reparacion.php">Barriles reparados</a></li>
                     </ul>
                  </li>
                  <li class="dos-cinco">
                     <a href="#"><i class="fa fa-desktop"></i> <span class="nav-label">TBRE</span><span class="fa arrow"></span></a>
                     <ul class="nav nav-second-level">
                        <li class="dos"><a href="validar_informacion.php">Validar información</a></li>
                        <li class="cinco"><a href="impresion.html">Impresión de etiquetas</a></li>
                     </ul>
                  </li>
                  <li class="seis">
                     <a href="#"><i class="fa fa-briefcase"></i> <span class="nav-label">Órdenes de trabajo</span><span class="fa arrow"></span></a>
                     <ul class="nav nav-second-level">
                        <li><a href="OLlenado.html">Llenado</a></li>
                        <li><a href="ORelleno.html">Relleno</a></li>
                        <li><a href="revision.html">Revisión</a></li>
                        <li><a href="OTrasiego.html">Trasiego</a></li>
                     </ul>
                  </li>
                  <li class="ocho">
                     <a href="#"><i class="fa fa-inbox"></i> <span class="nav-label">Recepción</span><span class="fa arrow"></span></a>
                     <ul class="nav nav-second-level collapse">
                        <li><a href="RAlcohol.html">Alcohol</a></li>
                        <li><a href="RBarriles.html">Barriles</a></li>
                     </ul>
                  </li>
                  <li class="uno-dos">
                     <a href="#"><i class="fa fa-bell"></i> <span class="nav-label">Solicitudes</span><span class="fa arrow"></span><span class="label label-primary float-right uno" style="margin-right:15px;"id="letrero1">0</span></a>
                     <ul class="nav nav-second-level collapse">
                        <li><a href="pendientes.html">Pendientes <span class="label label-primary float-right uno" id="letrero2">0</span></a></li>
                        <li><a href="aceptadas.html">Aceptadas</a></li>
                        <li><a href="rechazadas.html">Rechazadas</a></li>
                        <li><a href="canceladas.html">Canceladas</a></li>
                     </ul>
                  </li>
                  <li class="siete">
                     <a href="disenoAlmacen.html"><i class="fa fa-building"></i> <span class="nav-label">Diseñar almacenes</span></a>
                  </li>
                  <li class="nueve">
                     <a href="AjustesInventario.html"><i class="fa fa-edit"></i> <span class="nav-label">Ajustes de inventario</span></a>
                  </li>
                  <li class="tres-cuatro">
                     <a href="#"><i class="fa fa-gear"></i> <span class="nav-label">Administración</span><span class="fa arrow"></span></a>
                     <ul class="nav nav-second-level">
                        <li class="tres"><a href="usuarios.html">Usuarios</a></li>
                        <li class="cuatro"><a href="configuracion.html">Configuración</a></li>
                     </ul>
                  </li>
               </ul>
            </div>
         </nav>
         <div id="page-wrapper" class="gray-bg">
            <div class="row border-bottom">
               <nav class="navbar navbar-static-top" role="navigation" style="margin-bottom: 0">
                  <div class="navbar-header">
                     <a class="navbar-minimalize minimalize-styl-2 btn btn-primary " href="#"><i class="fa fa-bars"></i> </a>
                  </div>
                  <h2 class="nav navbar-top-links" style="margin-left:60px;">Mi perfil</h2>
                  <ul class="nav navbar-top-links navbar-right">
                     <li class="dropdown uno">
                        <a class="dropdown-toggle count-info" data-toggle="dropdown" href="#">
                        <i class="fa fa-bell"></i>  <span class="label label-primary" id="letrero3">0</span>
                        </a>
                        <ul class="dropdown-menu dropdown-alerts">
                           <li>
                              <a href="pendientes.html" class="dropdown-item">
                                 <div id="letrero4">
                                    <i class="fa fa-envelope fa-fw" ></i> Tienes 0 solicitudes de cambios
                                 </div>
                              </a>
                           </li>
                        </ul>
                     </li>
                     <li>
                        <a onclick="javascript:limpiar();">
                        <i class="fa fa-sign-out"></i> Cerrar sesión
                        </a>
                     </li>
                  </ul>
               </nav>
            </div>
            <div class="panel panel-default" style="margin-top:40px;">
               <div class="panel-heading">
                  <h4 class="panel-title">Mi información</h4>
               </div>
               <div class="panel-body">
                  <div class="col-md-12 text-center  d-flex justify-content-center" >
                     <div class="col-md-6 text-center" >
                        <h5><label>  Nombre:   </label>
                           <input type="text" class="form-control" required="true" name="nombre" id="nombre">
                        </h5>
                     </div>
                     <div class="col-md-6 text-center" >
                        <h5><label>  Usuario:   </label>
                           <input type="text" class="form-control" required="true" name="usuario" id="usuario" disabled>
                        </h5>
                     </div>
                  </div>
                  <div class="col-md-12 text-center  d-flex justify-content-center" >
                     <div class="col-md-6 text-center" >
                        <h5><label>  Grupo:   </label>
                           <input type="text" class="form-control" required="true" name="grupo" id="grupo" disabled>
                        </h5>
                     </div>
                     <div class="col-md-6 text-center " >
                        <h5><label>  Perfil:   </label>
                           <input type="text" class="form-control" required="true" name="perfil" id="perfil" disabled>
                        </h5>
                     </div>
                  </div>
                  <div class="col-md-12 text-center  d-flex justify-content-center" id="passw">
                     <div class="col-md-6 text-center  " >
                        <h5><label>  Nueva contraseña:   </label>
                           <input type="password" class="form-control" required="true" name="contrasena" id="contrasena">
                        </h5>
                     </div>
                     <div class="col-md-6 text-center" >
                        <h5><label>  Confirmar contraseña:   </label>
                           <input type="password" class="form-control" required="true" name="contrasenaC" id="contrasenaC">
                        </h5>
                     </div>
                  </div>
                  <div class="col-md-12 text-center  d-flex justify-content-center" >
                     <h5><label>  Cambiar contraseña:   </label>
                        <input type="checkbox" onchange='OcultarPass(this);' style="margin-right:40px;">
                     </h5>
                  </div>
                  <div class="col-md-12 text-center  d-flex justify-content-center" >
                     <button class="button5 btn btn-primary b-r-xl" onclick="GuardarDatos();" style="margin-right:70px;">Guardar cambios</button>
                  </div>
               </div>
            </div>
            <div class="footer">
               <div>
                  <strong>Todos los derechos reservados | </strong>SER Licorera 2014
               </div>
            </div>
         </div>
      </div>
      <!-- Mainly scripts -->
      <script src="js/jquery-3.1.1.min.js"></script>
      <script src="js/popper.min.js"></script>
      <script src="js/bootstrap.js"></script>
      <script src="js/plugins/metisMenu/jquery.metisMenu.js"></script>
      <script src="js/plugins/slimscroll/jquery.slimscroll.min.js"></script>
      <!-- Custom and plugin javascript -->
      <script src="js/inspinia.js"></script>
      <script src="js/plugins/pace/pace.min.js"></script>
      <script src="js/funciones_generales.js"></script>
      <script src="js/plugins/sweetalert/sweetalert.min.js"></script>
      <script>
         const getApi="get_perfil.php";
         const postApi="post_perfil.php";
         function OcultarPass(valor){
           if(valor.checked){
             $("#passw").css("visibility", "visible");
           }else{
             $("#passw").css("visibility", "hidden");
           }
         }
         async function GuardarDatos(){
           try {
             if(String(document.getElementById("contrasena").value).length>0 && String(document.getElementById("contrasena").value).length<6){
               await mensajeError("La contraseña debe ser mayor o igual a 5 caracteres");
               return;
             }
             if(document.getElementById("contrasena").value!==document.getElementById("contrasenaC").value){
               await mensajeError("Las contraseñas no coinciden");
               return;
             }
             if(document.getElementById("nombre").value===""){
               await mensajeError("El nombre no debe estar vacío");
               return;
             }

             if(document.getElementById("nombre").value===localStorage['nombre'] && document.getElementById("contrasena").value===""){
                   mensajeError("Cambia algún dato antes de guardar");
                   return;
             }
             var nContra="";
             if(String(document.getElementById("contrasena").value).length>0){
               nContra=btoa(document.getElementById("contrasena").value);
             }
             var params='nombre='+document.getElementById("nombre").value+'&npass='+nContra;
             var url='RestApi/POST/'+postApi;
             var result = await conexion("POST",url,params);
             await mensajeSimple("Datos actualizados correctamente");
             if(String(document.getElementById("contrasena").value).length>0){
               localStorage['password']=result;
             }
             localStorage['nombre']=document.getElementById("nombre").value;
             location.reload();
           } catch(error) {
             mensajeError(error);
           }
         }
         async function ObtenerDatos(){
           try {
             var url='RestApi/GET/'+getApi+'?perfil=true';
             var result = await conexion("GET",url,"");
             var parsed =JSON.parse(result);
             document.getElementById("nombre").value=parsed[0].Nombre;
             document.getElementById("perfil").value=parsed[0].Descripcion;
             document.getElementById("usuario").value=parsed[0].Clave;
             document.getElementById("grupo").value=parsed[0].IdGrupo;
           } catch(error) {
             await mensajeError(error);
           }
         }

         $(document).ready(function(){
           $("#passw").css("visibility", "hidden");
           ObtenerDatos();
         });
      </script>
   </body>
</html>
