<!DOCTYPE html>
<html>
   <head>
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <title>Reportes</title>
      <link href="css/bootstrap.min.css" rel="stylesheet">
      <link href="font-awesome/css/font-awesome.css" rel="stylesheet">
      <link rel="icon" href="img\TBRE.ico">
      <link rel="stylesheet" href="css/jquery-ui.css">
      <link href="css/animate.css" rel="stylesheet">
      <link href="css/style.css" rel="stylesheet">
      <link href="css/plugins/sweetalert/sweetalert.css" rel="stylesheet">
   </head>
   <body>
      <script src="js/revisar_sesion.js"></script>
      <div id="wrapper">
         <nav class="navbar-default navbar-static-side" role="navigation">
            <div class="sidebar-collapse">
               <ul class="nav metismenu" id="side-menu">
                  <li class="nav-header">
                     <div class="dropdown profile-element">
                        <img alt="image" class="rounded-circle perfil" id="perfil1"/>
                        <a data-toggle="dropdown" class="dropdown-toggle" href="#">
                           <span class="block m-t-xs font-bold">
                              <script>
                                 document.write(localStorage['nombre'] || 'Sin nombre');
                                 var foto=localStorage['nombre'] || 'Sin nombre';
                                 foto=foto.charAt(0).concat(".png").toLowerCase();
                                 document.getElementById("perfil1").src="img/letras/"+foto;
                              </script>
                           </span>
                           <span class="text-muted text-xs block">
                              <script>
                                 document.write(localStorage['perfil'] || 'Sin perfil');
                              </script><b class="caret"></b>
                           </span>
                        </a>
                        <ul class="dropdown-menu animated fadeInRight m-t-xs">
                           <li><a class="dropdown-item" href="perfil.html">Perfil</a></li>
                           <li class="dropdown-divider"></li>
                           <li><a class="dropdown-item" onclick="limpiar();">Cerrar sesión</a></li>
                        </ul>
                     </div>
                     <div class="logo-element">
                        TBRE
                     </div>
                  </li>
                  <li class="once">
                     <a href="index.html"><i class="fa fa-area-chart"></i> <span class="nav-label">Operación del día</span></a>
                  </li>
                  <li class="diez">
                     <a href="#"><i class="fa fa-table"></i> <span class="nav-label">Reportes</span><span class="fa arrow"></span></a>
                     <ul class="nav nav-second-level">
                       <li><a href="inventario.html">Inventario</a></li>
                       <li><a href="barriles_plantel.html">Barriles en plantel</a></li>
                       <li><a href="tanques_plantel.html">Tanques en plantel</a></li>
                       <li><a href="llenados.html">Barriles llenados</a></li>
                       <li><a href="rellenados.html">Barriles rellenados</a></li>
                       <li><a href="trasiego.html">Barriles trasegados</a></li>
                       <li><a href="trasiegoHoover.html">T. Hoover llenados</a></li>
                       <li><a href="RGerencia.html">Reporte de Gerencia</a></li>
                     </ul>
                  </li>
                  <li class="dos">
                     <a href="#"><i class="fa fa-desktop"></i> <span class="nav-label">Validar información</span><span class="fa arrow"></span></a>
                     <ul class="nav nav-second-level">
                        <li><a href="VI_barriles.php">Barriles</a></li>
                        <li><a href="VI_hoover.php">Tanques Hoover</a></li>
                     </ul>
                  </li>
                  <li class="cinco">
                     <a href="impresion.html"><i class="fa fa-print"></i> <span class="nav-label">Impresión de etiquetas</span></a>
                  </li>
                  <li class="seis active">
                     <a href="#"><i class="fa fa-briefcase"></i> <span class="nav-label">Órdenes de trabajo</span><span class="fa arrow"></span></a>
                     <ul class="nav nav-second-level">
                       <li>
                           <a href="#">Llenado<span class="fa arrow"></span></a>
                           <ul class="nav nav-third-level">
                               <li><a href="OLlenado.html">Orden Llenado</a></li>
                               <li><a href="RLlenadoLlenada.html">Reporte de Llenado</a></li>
                               <li><a href="RLlenadoMantenimineto.html">Reporte de Mantenimiento</a></li>
                               <li><a href="RLlenadoRevisado.html">Reporte de Revisado</a></li>
                           </ul>
                       </li>
                       <li>
                           <a href="#">Relleno<span class="fa arrow"></span></a>
                           <ul class="nav nav-third-level">
                               <li><a href="ORelleno.html">Orden Relleno</a></li>
                               <li><a href="RRellenoOperacion.html">Reporte de Operación</a></li>
                           </ul>
                       </li>
                       <li><a href="revision.html">Revisión</a></li>
                       <li  class="active">
                           <a href="#">Trasiego<span class="fa arrow"></span></a>
                           <ul class="nav nav-third-level">
                                <li><a href="OTrasiego.html">Orden Trasiego</a></li>
                                <li><a href="RTrasiegoHojaAnalisis.html">Hoja de Análisis de Trasiego</a></li>
                                <li><a href="RTrasiegoVaciados.html">Barriles vaciados por trasiego</a></li>
                                <li class="active"><a href="RTrasiegoRemision.html">Remisión blending</a></li>
                           </ul>
                       </li>
                       <li><a href="OTrasladoHoover.html">Traslado a Hoover</a></li>
                       <li><a href="OTrasiegoHoover.html">Trasiego Hoover</a></li>
                     </ul>
                  </li>
                  <li class="ocho">
                     <a href="#"><i class="fa fa-inbox"></i> <span class="nav-label">Recepción</span><span class="fa arrow"></span></a>
                     <ul class="nav nav-second-level collapse">
                        <li><a href="RAlcohol.html">Alcohol</a></li>
                        <li><a href="RBarriles.html">Barriles</a></li>
                        <li><a href="RTanquesHoover.html">Tanques Hoover</a></li>
                     </ul>
                  </li>
                  <li class="uno-dos">
                     <a href="#"><i class="fa fa-bell"></i> <span class="nav-label">Solicitudes</span><span class="fa arrow"></span><span class="label label-primary float-right uno" style="margin-right:15px;"id="letrero1">0</span></a>
                     <ul class="nav nav-second-level collapse">
                        <li><a href="pendientes.html">Pendientes <span class="label label-primary float-right uno" id="letrero2">0</span></a></li>
                        <li><a href="aceptadas.html">Aceptadas</a></li>
                        <li><a href="rechazadas.html">Rechazadas</a></li>
                        <li><a href="canceladas.html">Canceladas</a></li>
                     </ul>
                  </li>
                  <li class="siete">
                     <a href="disenoAlmacen.html"><i class="fa fa-building"></i> <span class="nav-label">Diseñar almacenes</span></a>
                  </li>
                  <li class="nueve">
                    <a href="#"><i class="fa fa-edit"></i> <span class="nav-label">Ajustes de inventario</span><span class="fa arrow"></span></a>
                    <ul class="nav nav-second-level collapse">
                       <li><a href="AjustesInventario.html">Inventario</a></li>
                       <li><a href="AjustesLlenado.html">Llenado</a></li>
                       <li><a href="AjustesRelleno.html">Relleno</a></li>
                    </ul>
                  </li>
                  <li class="tres-cuatro">
                     <a href="#"><i class="fa fa-gear"></i> <span class="nav-label">Administración</span><span class="fa arrow"></span></a>
                     <ul class="nav nav-second-level">
                        <li class="tres"><a href="usuarios.html">Usuarios</a></li>
                        <li class="cuatro"><a href="configuracion.html">Configuración</a></li>
                     </ul>
                  </li>
               </ul>
            </div>
         </nav>
         <div id="page-wrapper" class="gray-bg">
            <div class="row border-bottom">
               <nav class="navbar navbar-static-top" role="navigation" style="margin-bottom: 0">
                  <div class="navbar-header">
                     <a class="navbar-minimalize minimalize-styl-2 btn btn-primary " href="#"><i class="fa fa-bars"></i> </a>
                  </div>
                  <h2 class="nav navbar-top-links welcome-message" style="margin-left:60px;">Almacén de Envejecimiento</h2>
                  <ul class="nav navbar-top-links navbar-right">
                     <li class="dropdown uno">
                        <a class="dropdown-toggle count-info" data-toggle="dropdown" href="#">
                        <i class="fa fa-bell"></i>  <span class="label label-primary" id="letrero3">0</span>
                        </a>
                        <ul class="dropdown-menu dropdown-alerts">
                           <li>
                              <a href="pendientes.html" class="dropdown-item">
                                 <div id="letrero4">
                                    <i class="fa fa-envelope fa-fw" ></i> Tienes 0 solicitudes de cambios
                                 </div>
                              </a>
                           </li>
                        </ul>
                     </li>
                     <li>
                        <a onclick="javascript:limpiar();">
                        <i class="fa fa-sign-out"></i> Cerrar sesión
                        </a>
                     </li>
                  </ul>
               </nav>
            </div>
            <div class="row wrapper border-bottom white-bg page-heading d-flex justify-content-center" style="margin-bottom:30px;">
              <div class="col-md-12">
                <div class=" col-md-12 row">
                  <img class="col-lg-5" src="img/logo-ser-licorera-blanco.jpg" border="0" id="imagenLogo">
                  <h2 class="col-lg-7 font-bold flex-row-reverse row" style="margin-top:40px;">Trazabilidad de Barriles y Rones Envejecidos</h2>
                </div>
                <div class=" col-md-12 row">
                  <h2 class="col-lg-8" style="margin-top:10px;">Remisión Alcoholes de Entrega Blending</h2>
                  <div class="col-lg-4 flex-row-reverse row" >
                    <h2 style="margin-top:10px;">FSI-82.4.6.2</h2>
                  </div>
                </div>
              </div>
              <div class="col-md-8 text-center d-flex justify-content-center">
                <h5>
                   <label>Tanque: <select class="form-control b-r-xl" id="tanque" onchange="ObtenerDatos()"></select></label>
                </h5>
                <h5>
                   <label>Fecha: <input type="date" class="form-control b-r-xl" required="true" id="fecha" onchange="ObtenerDatos()" onkeydown="return false"></label>
                </h5>
                <h5>
                   <button class="b-r-xl btn btn-primary " onclick="guardarDatos()" id="guardar" style="margin-top:15px;" disabled>Guardar</button>
                </h5>
                <h5>
                   <button class="button5 btn btn-primary b-r-xl" onclick="abrir('enviosBlending.html')" style="margin-top:15px;">Envios</button>
                </h5>


              </div>
              <div class="col-md-9  d-flex justify-content-center" >
                <div class="col-md-6 " >
                  <div class="col-md-12">
                    <h5><label>Remitente: <label class="subrrayado">Almacen Envejecimiento</label></label></h5>
                  </div>
                  <div class="col-md-12">
                    <h5><label>Para: <label class="subrrayado">BLENDING</label></label></h5>
                  </div>
                  <div class="col-md-12">
                    <h5><label>Fecha: <label class="subrrayado" id="fechaD">...</label></label></h5>
                  </div>
                </div>
                <div class="col-md-6" >
                  <div class="col-md-12">
                    <h5 class="col-md-12 d-flex"><label style="margin-top:10px;margin-right:5px;">Envío N°: </label><input type="number" style="max-width:150px;" class="form-control b-r-xl" required="true" id="envioNo" disabled></h5>
                  </div>
                  <div class="col-md-12">
                    <h5><label>Destino: <label class="subrrayado">BLENDING</label></label></h5>
                  </div>
                  <div class="col-md-12">
                    <h5><label>Hora: <label class="subrrayado" id="hora">...</label></label></h5>
                  </div>
                </div>
              </div>
              <div class="col-md-12 justify-content-center text-center" style="margin-top:15px;">
                <div class="table-responsive col-md-10 centro">
                  <table class="table-bordered cell-border col-md-12" id="tablaPrincipal" hidden>
                    <thead>
                      <tr>
                         <th colspan="2">Origen</th>
                         <th colspan="2">Destino</th>
                         <th rowspan="2">Tanque</th>
                         <th rowspan="2">Litros</th>
                         <th rowspan="2">Item</th>
                         <th rowspan="2">Año</th>
                         <th rowspan="2">Opc</th>
                      </tr>
                      <tr>
                        <th>Almacén</th>
                        <th>Ubicación</th>
                        <th>Almacén</th>
                        <th>Ubicación</th>
                      </tr>
                    </thead>
                    <tbody></tbody>
                    <tfoot></tfoot>
                  </table>
                  <button class="b-r-xl btn btn-primary " onclick="agregarDato()" id="agregarDato" style="margin-bottom:20px;margin-top:40px;" hidden>Nuevo dato</button>
                </div>
                <div class="sk-spinner sk-spinner-three-bounce col-md-12">
                   <div class="sk-bounce1"></div>
                   <div class="sk-bounce2"></div>
                   <div class="sk-bounce3"></div>
                </div>
              </div>
              <div class="col-md-10 d-flex justify-content-center" style="margin-top:20px; margin-bottom:20px;">
                <div class="col-md-9 d-flex  row" style="margin-bottom:5px;">
                  <div class="col-md-4">
                    <label>Observaciones:</label>
                  </div>
                  <div class="col-md-8">
                    <div class="col-md-12 subrrayado">
                      <h5 class="col-md-12 d-flex"><label style="margin-top:10px;margin-right:5px;">Tq: </label><input type="text" style="max-width:550px;" class="form-control b-r-xl" required="true" id="tq"></h5>
                    </div>
                    <div class="col-md-12 subrrayado" >
                      <h5 class="col-md-12 d-flex"><label style="margin-top:10px;margin-right:5px;">FCV: </label><input type="text" style="max-width:450px;" class="form-control b-r-xl" required="true" id="fcv"></h5>
                    </div>
                    <div class="col-md-12 subrrayado" >
                      <label style="margin-top:25px;"></label>
                    </div>
                    <div class="col-md-12 subrrayado" >
                      <label style="margin-top:15px;font-weight: bold;">Alcohol No Sustentable  </label>
                    </div>
                  </div>
                </div>
                <div class="col-md-3 d-flex justify-content-center row" style="margin-bottom:5px;">
                </div>
              </div>
              <div class="col-md-10 text-center row" style="margin-top:20px; margin-bottom:20px;">
                <div class="col-md-12 d-flex justify-content-center " style="margin-bottom:5px;">
                  <div class="col-md-4">
                    <label>Verificado y entregado</label>
                  </div>
                  <div class="col-md-2">
                  </div>
                  <div class="col-md-4">
                    <label>Recibi conforme</label>
                  </div>
                </div>
                <div class="col-md-12 d-flex justify-content-center " style="margin-top:60px;">
                  <div class="col-md-4" style="border-top:1px solid #333">
                    <label>Almacén Envejecido</label>
                  </div>
                  <div class="col-md-2" >
                  </div>
                  <div class="col-md-4" style="border-top:1px solid #333">
                    <label>Almacén Blending</label>
                  </div>
                </div>
              </div>
              <div class="col-md-10 row" style="margin-top:20px;">
                <div class="col-md-12">
                  <label>Original: Almacén Blending</label>
                </div>
                <div class="col-md-12">
                  <label>Copia: Almacén Logistica</label>
                </div>
                <div class="col-md-12">
                  <label>Cc: Archivo</label>
                </div>
              </div>
            </div>
            <a href="#" class="aDes floatDes btnDes" id="menu-share">
              <i class="fa fa-download my-float"></i>
            </a>
            <ul class="ulDes">
              <li><a href="javascript:generar('jpg','foto');" class="btnDes aDes">
                <i class="fa fa-file-image-o my-float" id="foto"></i>
                <div class="label-container">
                  <div class="label-text">JPG</div>
                  <i class="fa fa-play label-arrow"></i>
                </div>
              </a></li>
              <li><a href="javascript:generar('pdf','pdf');" class="btnDes aDes">
                <i class="fa fa-file-pdf-o my-float" id="pdf"></i>
                <div class="label-container">
                  <div class="label-text">PDF</div>
                  <i class="fa fa-play label-arrow"></i>
                </div>
              </a></li>
              <li><a href="javascript:generar('xlsx','excel');" class="btnDes aDes" >
                <i class="fa fa-file-excel-o my-float" id="excel"></i>
                <div class="label-container">
                  <div class="label-text">Excel</div>
                  <i class="fa fa-play label-arrow"></i>
                </div>
              </a></li>
            </ul>
            <div class="footer">
               <div>
                  <strong>Todos los derechos reservados | </strong>SER Licorera 2014
               </div>
            </div>
         </div>
      </div>
      <!-- Mainly scripts -->
      <script src="js/jquery-3.1.1.min.js"></script>
      <script src="js/popper.min.js"></script>
      <script src="js/bootstrap.js"></script>
      <script src="js/plugins/metisMenu/jquery.metisMenu.js"></script>
      <script src="js/plugins/slimscroll/jquery.slimscroll.min.js"></script>
      <!-- Custom and plugin javascript -->
      <script src="js/inspinia.js"></script>
      <script src="js/plugins/pace/pace.min.js"></script>
      <script src="js/funciones_generales.js"></script>
      <script src="js/plugins/sweetalert/sweetalert.min.js"></script>

      <script src="js/plugins/ladda/spin.min.js"></script>
      <script src="js/plugins/ladda/ladda.min.js"></script>
      <script src="js/plugins/ladda/ladda.jquery.min.js"></script>
      <script src="js/abrir_ventana.js"></script>
      <script>
         const getApi="get_ReportesTrasiego.php";
         const postApi="post_trasiegoReportes.php";

         async function ObtenerDatos(){
           if($('#fecha').val()==='' || $('#tanque').val()===''){
             toggleCampos(true);
             return;
           }
           try {
             empezar();
             $('#tablaPrincipal > tbody').empty();
             $('#tablaPrincipal > tfoot').empty();
             $('#fechaD').text(PickerToNormal($('#fecha').val()));
             var url='RestApi/GET/'+getApi+'?FSI61194=true&fecha='+$('#fecha').val()+'&tanque='+$('#tanque').val();
             var result = await conexion("GET",url,"");
             var parsed =JSON.parse(result);
             toggleCampos(false);
             //Encontro un envio con estas caracteristicas
             if(parsed[0].idTanque!==undefined){
               if(await mensajeOpcional('Ya existe un envío con estos datos, ¿deseas verlo o editarlo?')){
                 $('#hora').text(getHora());
                 $('#tq').val(parsed[0]["tq"]);
                 $('#fcv').val(parsed[0]["fcv"]);
                 $('#envioNo').val(parsed[0].EnvioNo);
                 var total=0;
                 url='RestApi/GET/'+getApi+'?alcohol=true';
                 result = await conexion("GET",url,"");
                 alcoholes =JSON.parse(result);
                 for (var i = 0; i < parsed.length; i++) {
                   nuevoDato(alcoholes,parsed[i].idItem,parsed[i].Litros,parsed[i].Codigo);
                   total+=(parsed[i].Litros!==null?parseFloat(parsed[i].Litros):0);
                 }
                 $('#tablaPrincipal > tfoot').append('<tr><td></td><td></td><td></td><td colspan="2">Total</td><td id="totalLts">'+fomatoNumero(total)+'</td><td colspan="2">Litros</td></tr>');
               }else{
                 toggleCampos(true);
               }

             }else{//No hay envios con estás caracteristicas
               $('#envioNo').val(parsed[0].Envio);
               $('#tq').val('');
               $('#fcv').val('');
               $('#hora').text(getHora());
               $('#tablaPrincipal > tfoot').append('<tr><td></td><td></td><td></td><td colspan="2">Total</td><td id="totalLts">'+fomatoNumero(0)+'</td><td colspan="2">Litros</td><td></td></tr>');
             }
           } catch(error) {
             toggleCampos(true);
             await mensajeError(error);
           }finally {
             parar();
           }
         }
         function getHora(){
           var date=new Date();
           return '  '+date.getHours()+':'+date.getMinutes()+'  ';
         }
         function toggleCampos(boleano){
           $('#tablaPrincipal').attr('hidden',boleano);
           $('#agregarDato').attr('hidden',boleano);
           $('#guardar').attr('disabled',boleano);
         }

         async function guardarDatos(){
           if($('#tablaPrincipal tbody tr').length == 0){
             alert('No se puede guardar un envío sin datos de remisión');
             return;
           }
           var tq=$('#tq').val(),fcv=$('#fcv').val(),tanque=$('#tanque').val(),fecha=$('#fecha').val(),check=false;
           var detalles=[];
           $( "#tablaPrincipal tbody tr" ).each(function() {
             var item=$( this ).children('td:nth-child(8)').find("select").val();
             if(item===''){
               check=true;
               return;
             }
             var litros=$(this).children('td:nth-child(6)').find("input").val();
             detalles.push({IdItem: item, Litros: (litros!==''?litros:0)});//Se obtienen los valores de la primera posicion creando un arreglo de consecutivos
           });
           if(check){
             alert('El alcohol de todos los campos debe estar seleccionado');
             return;
           }
           if(await mensajeOpcional('Se agregará/modificará un envío del '+$('#tanque :selected').text()+' con fecha:'+PickerToNormal(fecha)+' ¿Deseas continuar?')){
             try {
               var url='RestApi/POST/'+postApi;
               var params='fecha='+fecha+'&detalles='+JSON.stringify(detalles)+"&tanque="+tanque+"&tq="+tq+"&fcv="+fcv;
               var result=await conexion("POST", url,params);
               setTimeout(function() {
                 mensajeSimple(result);
               }, 500);
             } catch (e) {
               setTimeout(function() {
                 mensajeError(e);
               }, 500);
             } finally {

             }


           }

         }

         async function agregarDato(){
           try {
             var url='RestApi/GET/'+getApi+'?alcohol=true';
             var result = await conexion("GET",url,"");
             var alcoholes =JSON.parse(result);
             nuevoDato(alcoholes,'','','');
           } catch (e) {
             mensajeError(e);
           }
         }
         function nuevoDato(alcoholes,selAlcohol,litros,codigo){
           var content='<tr><td><input type="text" style="max-width:80px;" value="AEE" disabled></td>'+
           '<td><input type="text" style="max-width:80px;" value="BODENV1" disabled></td>'+
           '<td><input type="text" style="max-width:80px;" value="AEB" disabled></td>'+
           '<td><input type="text" style="max-width:80px;" value="TANQB1" disabled></td>'+
           '<td><input type="text" value="'+$("#tanque :selected").text()+'" disabled></td>'+
           '<td><input type="number" style="max-width:100px;" onchange="actualizaTotal()" placeholder="0" id="litrosSelec" value="'+litros+'" ></td>'+
           '<td><input type="text" style="max-width:100px;" value="'+codigo+'" id="codigoItem" disabled></td>'+
           seleccionarAlcohol(alcoholes,selAlcohol,"")+
           '<td class="justify-content-center"><button class="btn btn-danger b-r-xl fa fa-trash" onclick="cancelarDato(this);"></button></td></tr>';
           $('#tablaPrincipal > tbody').append(content);
           revisarTema();
         }
         function actualizaTotal(){
           var total=0;
           $( "#tablaPrincipal tbody tr" ).each(function() {
             var valor=$(this).children('td:nth-child(6)').find("input").val()
             total+=(valor!==''?parseFloat(valor):0);
           });
           $("#totalLts").text(fomatoNumero(total));
         }
         function cancelarDato(campo){
           var $row = $(campo).closest('tr');
           $row.remove();
           actualizaTotal();
         }
         function seleccionarAlcohol(valores,seleccion,opc){
           var content='<td><select class="form-control" style="min-width:100px;" id="descripcion" onchange="escogerItem(this);" '+opc+'><option value=""></option>';
           for (var i = 0; i < valores.length; i++) {
             if(valores[i]['IdItem']===seleccion){
               content+='<option value="'+valores[i].IdItem+'" selected>'+valores[i].Año+'</option>';
             }else{
               content+='<option value="'+valores[i].IdItem+'">'+valores[i].Año+'</option>';
             }
           }
           content+="</select></td>";
           return content;
         }
         async function escogerItem(campo){
           try {
             var $row = $(campo).closest('tr');
             if(campo.value!==''){
               var url='RestApi/GET/'+getApi+'?alcohol='+campo.value;
               var result = await conexion("GET",url,"");
               var alcoholes =JSON.parse(result);
               $row.find('td').find("#codigoItem").val(alcoholes[0].Codigo);
             }else{
               $row.find('td').find("#codigoItem").val('');
             }
           } catch (e) {
             mensajeError(e);
           }
         }
         async function generar(tipo,boton){
           if($('#tablaPrincipal tbody tr').length > 0){
             var l = $('#'+boton).ladda();
             try {
               l.ladda('start');
               var url=getNode+"?reporte=RTrasiegoRemision&fecha="+$('#fecha').val()+'&tipo='+boton+'&tanque='+$('#tanque').val();
               var valor=await conexion("GET",url,"");
               let link = document.createElement("a");
               link.download = "Reporte Remision Alcoholes de Entrega Blending "+PickerToNormal($('#fecha').val())+"."+tipo;
               link.href = valor;
               link.click();
             } catch (e) {
               mensajeError(e);
             } finally {
               l.ladda('stop');
             }
           }else{
             mensajeError("No hay datos que exportar");
           }
         }
         async function cargaTanques(){
           try {
             var url='RestApi/GET/'+getApi+'?tanques=true';
             var result = await conexion("GET",url,"");
             var parsed =JSON.parse(result);
             llenarSelect('#tanque',"IDTanque","Descripcion",parsed);
           } catch (e) {
             mensajeError(e);
           }
         }

         $(document).ready(function(){
           permisos(["6"]);
           toggleCampos(true);
           setDates(['#fecha'],'Y-m-d');
           //$('#fechaD').text($('#fecha').val());
           cargaTanques();
         });
      </script>
   </body>
</html>
