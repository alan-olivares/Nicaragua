<!DOCTYPE html>
<html>
   <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
   <head>
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <title>Orden de relleno</title>
      <link href="css/jquery.dataTables.min.css" rel="stylesheet">
      <link href="css/bootstrap.min.css" rel="stylesheet">
      <link href="font-awesome/css/font-awesome.css" rel="stylesheet">
      <link rel="icon" href="img\TBRE.ico">
      <link rel="stylesheet" href="css/jquery-ui.css">
      <link href="css/animate.css" rel="stylesheet">
      <link href="css/style.css" rel="stylesheet">
      <link rel="stylesheet" href="/resources/demos/style.css">
      <link href="css/plugins/sweetalert/sweetalert.css" rel="stylesheet">
      <link href="css/plugins/datapicker/datepicker3.css" rel="stylesheet">
      <link href="css/plugins/ladda/ladda-themeless.min.css" rel="stylesheet">
   </head>
   <body>
      <script src="js/revisar_sesion.js"></script>
      <div id="wrapper">
         <nav class="navbar-default navbar-static-side" role="navigation">
            <div class="sidebar-collapse">
               <ul class="nav metismenu" id="side-menu">
                  <li class="nav-header">
                     <div class="dropdown profile-element">
                        <img alt="image" class="rounded-circle perfil" id="perfil1"/>
                        <a data-toggle="dropdown" class="dropdown-toggle" href="#">
                           <span class="block m-t-xs font-bold">
                              <script>
                                 document.write(localStorage['nombre'] || 'Sin nombre');
                                 var foto=localStorage['nombre'] || 'Sin nombre';
                                 foto=foto.charAt(0).concat(".png").toLowerCase();
                                 document.getElementById("perfil1").src="img/letras/"+foto;
                              </script>
                           </span>
                           <span class="text-muted text-xs block">
                              <script>
                                 document.write(localStorage['perfil'] || 'Sin perfil');
                              </script><b class="caret"></b>
                           </span>
                        </a>
                        <ul class="dropdown-menu animated fadeInRight m-t-xs">
                           <li><a class="dropdown-item" href="perfil.html">Perfil</a></li>
                           <li class="dropdown-divider"></li>
                           <li><a class="dropdown-item" onclick="limpiar();">Cerrar sesión</a></li>
                        </ul>
                     </div>
                     <div class="logo-element">
                        TBRE
                     </div>
                  </li>
                  <li class="once">
                     <a href="index.html"><i class="fa fa-area-chart"></i> <span class="nav-label">Operación del día</span></a>
                  </li>
                  <li class="diez">
                     <a href="#"><i class="fa fa-table"></i> <span class="nav-label">Reportes</span><span class="fa arrow"></span></a>
                     <ul class="nav nav-second-level">
                       <li><a href="inventario.html">Inventario</a></li>
                       <li><a href="barriles_plantel.html">Barriles en plantel</a></li>
                       <li><a href="tanques_plantel.html">Tanques en plantel</a></li>
                       <li><a href="llenados.html">Barriles llenados</a></li>
                       <li><a href="rellenados.html">Barriles rellenados</a></li>
                       <li><a href="trasiego.html">Barriles trasegados</a></li>
                       <li><a href="trasiegoHoover.html">T. Hoover llenados</a></li>
                       <li><a href="RGerencia.html">Reporte de Gerencia</a></li>
                     </ul>
                  </li>
                  <li class="dos">
                     <a href="#"><i class="fa fa-desktop"></i> <span class="nav-label">Validar información</span><span class="fa arrow"></span></a>
                     <ul class="nav nav-second-level">
                        <li><a href="VI_barriles.php">Barriles</a></li>
                        <li><a href="VI_hoover.php">Tanques Hoover</a></li>
                     </ul>
                  </li>
                  <li class="cinco">
                     <a href="impresion.html"><i class="fa fa-print"></i> <span class="nav-label">Impresión de etiquetas</span></a>
                  </li>
                  <li class="seis active">
                     <a href="#"><i class="fa fa-briefcase"></i> <span class="nav-label">Órdenes de trabajo</span><span class="fa arrow"></span></a>
                     <ul class="nav nav-second-level">
                       <li>
                           <a href="#">Llenado<span class="fa arrow"></span></a>
                           <ul class="nav nav-third-level">
                               <li><a href="OLlenado.html">Orden Llenado</a></li>
                               <li><a href="RLlenadoLlenada.html">Reporte de Llenado</a></li>
                               <li><a href="RLlenadoMantenimineto.html">Reporte de Mantenimiento</a></li>
                               <li><a href="RLlenadoRevisado.html">Reporte de Revisado</a></li>
                           </ul>
                       </li>
                       <li class="active">
                           <a href="#">Relleno<span class="fa arrow"></span></a>
                           <ul class="nav nav-third-level">
                               <li class="active"><a href="ORelleno.html">Orden Relleno</a></li>
                               <li><a href="RRellenoOperacion.html">Reporte de Operación</a></li>
                           </ul>
                       </li>
                       <li><a href="revision.html">Revisión</a></li>
                       <li>
                           <a href="#">Trasiego<span class="fa arrow"></span></a>
                           <ul class="nav nav-third-level">
                                <li><a href="OTrasiego.html">Orden Trasiego</a></li>
                                <li><a href="RTrasiegoHojaAnalisis.html">Hoja de Análisis de Trasiego</a></li>
                                <li><a href="RTrasiegoVaciados.html">Barriles vaciados por trasiego</a></li>
                                <li><a href="RTrasiegoRemision.html">Remisión blending</a></li>
                           </ul>
                       </li>
                       <li><a href="OTrasiegoHoover.html">Trasiego Hoover</a></li>
                     </ul>
                  </li>
                  <li class="ocho">
                     <a href="#"><i class="fa fa-inbox"></i> <span class="nav-label">Recepción</span><span class="fa arrow"></span></a>
                     <ul class="nav nav-second-level collapse">
                        <li><a href="RAlcohol.html">Alcohol</a></li>
                        <li><a href="RBarriles.html">Barriles</a></li>
                        <li><a href="RTanquesHoover.html">Tanques Hoover</a></li>
                     </ul>
                  </li>
                  <li class="uno-dos">
                     <a href="#"><i class="fa fa-bell"></i> <span class="nav-label">Solicitudes</span><span class="fa arrow"></span><span class="label label-primary float-right uno" style="margin-right:15px;"id="letrero1">0</span></a>
                     <ul class="nav nav-second-level collapse">
                        <li><a href="pendientes.html">Pendientes <span class="label label-primary float-right uno" id="letrero2">0</span></a></li>
                        <li><a href="aceptadas.html">Aceptadas</a></li>
                        <li><a href="rechazadas.html">Rechazadas</a></li>
                        <li><a href="canceladas.html">Canceladas</a></li>
                     </ul>
                  </li>
                  <li class="siete">
                     <a href="disenoAlmacen.html"><i class="fa fa-building"></i> <span class="nav-label">Diseñar almacenes</span></a>
                  </li>
                  <li class="nueve">
                    <a href="#"><i class="fa fa-edit"></i> <span class="nav-label">Ajustes de inventario</span><span class="fa arrow"></span></a>
                    <ul class="nav nav-second-level collapse">
                       <li><a href="AjustesInventario.html">Inventario</a></li>
                       <li><a href="AjustesLlenado.html">Llenado</a></li>
                       <li><a href="AjustesRelleno.html">Relleno</a></li>
                    </ul>
                  </li>
                  <li class="tres-cuatro">
                     <a href="#"><i class="fa fa-gear"></i> <span class="nav-label">Administración</span><span class="fa arrow"></span></a>
                     <ul class="nav nav-second-level">
                        <li class="tres"><a href="usuarios.html">Usuarios</a></li>
                        <li class="cuatro"><a href="configuracion.html">Configuración</a></li>
                     </ul>
                  </li>
               </ul>
            </div>
         </nav>
         <div id="page-wrapper" class="gray-bg">
            <div class="row border-bottom">
               <nav class="navbar navbar-static-top" role="navigation" style="margin-bottom: 0">
                  <div class="navbar-header">
                     <a class="navbar-minimalize minimalize-styl-2 btn btn-primary " href="#"><i class="fa fa-bars"></i> </a>
                  </div>
                  <h2 class="nav navbar-top-links welcome-message" style="margin-left:120px; margin-right:10px;">Órdenes de relleno</h2>
                  <ul class="nav navbar-top-links navbar-right">
                     <li class="dropdown uno">
                        <a class="dropdown-toggle count-info" data-toggle="dropdown" href="#">
                        <i class="fa fa-bell"></i>  <span class="label label-primary" id="letrero3">0</span>
                        </a>
                        <ul class="dropdown-menu dropdown-alerts">
                           <li>
                              <a href="pendientes.html" class="dropdown-item">
                                 <div id="letrero4">
                                    <i class="fa fa-envelope fa-fw" ></i> Tienes 0 solicitudes de cambios
                                 </div>
                              </a>
                           </li>
                        </ul>
                     </li>
                     <li>
                        <a onclick="javascript:limpiar();">
                        <i class="fa fa-sign-out"></i> Cerrar sesión
                        </a>
                     </li>
                  </ul>
               </nav>
            </div>
            <div class="tabs-container">
               <ul class="nav nav-tabs d-flex justify-content-center" role="tablist">
                  <li><a class="nav-link active" data-toggle="tab" href="#generar"> Generar órdenes</a></li>
                  <li><a class="nav-link" data-toggle="tab" onclick="ActualizarOrdenes('hoy',false);" href="#ver">Ver órdenes</a></li>
                  <li><a class="nav-link" data-toggle="tab" href="#pendientes">Pendientes/Activas</a></li>
               </ul>
               <div class="tab-content">
                  <div role="tabpanel" id="generar" class="tab-pane active">
                     <div class="panel panel-default" style="margin-top:0px;">
                        <div class="row text-center  white-bg  d-flex justify-content-center" >
                           <button class="button5 btn btn-primary b-r-xl" style="margin-bottom:20px;" onclick='CargarDialogo();' id="agregarOrd" disabled>Agregar ordenes</button>
                           <button class="button5 btn btn-warning b-r-xl" style="margin-bottom:20px;" onclick='descativarBotones(this);' id="quitarSel" hidden>Quitar seleccionado(s)</button>
                        </div>
                        <div class="col-md-12 d-flex justify-content-center table-responsive text-center " id="table-wrapper">
                           <div class="table-responsive col-md-12 centro" id="scrollingtable">
                              <table class="table table-bordered cell-border" id="lotes">
                                 <thead>
                                    <tr>
                                       <th>Número</th>
                                       <th>Bodega</th>
                                       <th>Fecha alcohol</th>
                                       <th>Alcohol</th>
                                       <th>Uso</th>
                                       <th>Cantidad</th>
                                       <th>Litros</th>
                                    </tr>
                                 </thead>
                                 <tbody></tbody>
                              </table>
                              <div class="sk-spinner spinner1">
                                 <div class="sk-bounce1"></div>
                                 <div class="sk-bounce2"></div>
                                 <div class="sk-bounce3"></div>
                              </div>
                           </div>
                        </div>
                     </div>
                  </div>
                  <div role="tabpanel" id="ver" class="tab-pane">
                     <div class="row text-center  white-bg  d-flex justify-content-center">
                        <div class="col-md-12 text-center  d-flex justify-content-center" >
                           <div class="col-md-4 text-center"style="max-width:250px;" id="data_1">
                              <h5>
                                 <label>  Fecha de filtro:   </label>
                                 <div class="input-group date">
                                    <span class="input-group-addon"><i class="fa fa-calendar"></i></span><input type="text" class="form-control" id="FOrdenes" onchange="ActualizarOrdenes(this.value,false);" data-date-format='yy-mm-dd'>
                                 </div>
                              </h5>
                           </div>
                        </div>
                        <div class="col-md-12 d-flex justify-content-center table-responsive text-center " id="table-wrapper">
                           <div class="table-responsive col-md-12 centro" id="scrollingtable">
                              <table class="table table-bordered cell-border" id="lotesOrden">
                                 <thead>
                                    <tr>
                                       <th>Orden</th>
                                       <th>Bodega</th>
                                       <th>Cantidad</th>
                                       <th>Paletas</th>
                                       <th>Operador</th>
                                       <th>Montacarguista</th>
                                       <th>Supervisor</th>
                                       <th>Estatus</th>
                                       <th>Opción</th>
                                    </tr>
                                 </thead>
                                 <tbody></tbody>
                              </table>
                              <div class="sk-spinner sk-spinner-three-bounce">
                                 <div class="sk-bounce1"></div>
                                 <div class="sk-bounce2"></div>
                                 <div class="sk-bounce3"></div>
                              </div>
                           </div>
                        </div>
                     </div>
                  </div>
                  <div role="tabpanel" id="pendientes" class="tab-pane">
                     <div class="row text-center  white-bg  d-flex justify-content-center">
                        <div class="col-md-12 d-flex justify-content-center table-responsive text-center " id="table-wrapper">
                           <div class="table-responsive col-md-12 centro" id="scrollingtable">
                              <table class="table table-bordered cell-border" style="margin-top:50px;" id="lotesOrdenTodas">
                                 <thead>
                                    <tr>
                                      <th>Orden</th>
                                      <th>Bodega</th>
                                      <th>Cantidad</th>
                                      <th>Paletas</th>
                                      <th>Operador</th>
                                      <th>Montacarguista</th>
                                      <th>Supervisor</th>
                                      <th>Estatus</th>
                                      <th>Opción</th>
                                    </tr>
                                 </thead>
                                 <tbody></tbody>
                              </table>
                              <div class="sk-spinner sk-spinner-three-bounce">
                                 <div class="sk-bounce1"></div>
                                 <div class="sk-bounce2"></div>
                                 <div class="sk-bounce3"></div>
                              </div>
                           </div>
                        </div>
                     </div>
                  </div>
               </div>
            </div>
            <div class="footer">
               <div>
                  <strong>Todos los derechos reservados | </strong>SER Licorera 2014
               </div>
            </div>
            <div id="Dialog" title="Resumen de órden" class="animated">
               <div>
                  <div class="col-md-12 text-center  d-flex justify-content-center" >
                     <div class="table-responsive col-md-12 centro" >
                        <table class="table table-bordered table-hover display"  id="generarOrdenes">
                           <thead>
                              <tr>
                                 <th>Bodega</th>
                                 <th>Año</th>
                                 <th>Alcohol</th>
                                 <th>Uso</th>
                                 <th>Cantidad</th>
                              </tr>
                           </thead>
                           <tbody></tbody>
                        </table>
                     </div>
                  </div>
                  <div class="sk-spinner sk-spinner-three-bounce">
                     <div class="sk-bounce1"></div>
                     <div class="sk-bounce2"></div>
                     <div class="sk-bounce3"></div>
                  </div>
                  <div class="col-md-12 text-center  d-flex justify-content-center" >
                     <button class="button5 btn btn-primary cerrar">Cerrar</button>
                     <button class="ladda-button button5 btn btn-primary" onclick="GenerarOrdenes();" data-style="zoom-in" id="generarO">Generar ordenes</button>
                  </div>
               </div>
            </div>
         </div>
      </div>
      <!-- Mainly scripts -->
      <script src="js/jquery-3.1.1.min.js"></script>
      <script src="js/jquery-ui.js"></script>
      <script src="js/jquery.dataTables.min.js"></script>
      <script src="js/plugins/dataTables/datatables.min.js"></script>
      <script src="js/plugins/dataTables/dataTables.bootstrap4.min.js"></script>
      <script src="js/bootstrap-waitingfor.js"></script>
      <script src="js/json2html.min.js"></script>
      <script src="js/popper.min.js"></script>
      <script src="js/bootstrap.js"></script>
      <script src="js/plugins/metisMenu/jquery.metisMenu.js"></script>
      <script src="js/plugins/slimscroll/jquery.slimscroll.min.js"></script>
      <script src="js/plugins/datapicker/bootstrap-datepicker.js"></script>
      <script src="js/plugins/ladda/spin.min.js"></script>
      <script src="js/plugins/ladda/ladda.min.js"></script>
      <script src="js/plugins/ladda/ladda.jquery.min.js"></script>
      <!-- Custom and plugin javascript -->
      <script src="js/inspinia.js"></script>
      <script src="js/plugins/sweetalert/sweetalert.min.js"></script>
      <script src="js/funciones_generales.js"></script>
      <script>
         const getApi="get_ORelleno.php";
         const postApi="post_ORelleno.php";
         $( function() {
           var options={
             open: function() {
                 $(this).closest(".ui-dialog")
                 .find(".ui-dialog-titlebar-close")
                 .removeClass("ui-dialog-titlebar-close").addClass("b-r-xl btn btn-danger");
             },
             autoOpen: false,
             height: 'auto',
             modal: true,
             closeOnEscape: true,
             show: {
               effect: "puff",
               duration: 800
             },
             hide: {
               effect: "drop",
               duration: 800
             },
             maxHeight: 570,
             minWidth: 550,
           };

           generarOrdenes = $( "#Dialog" ).dialog(options);
         $( ".cerrar" ).button().on( "click", function() {
           generarOrdenes.dialog( "close" );
         });


         } );
         function comenzar(id){
           $(id+" div").css("visibility","visible");
         }
         function terminar(id){
           $(id+" div").css("visibility","hidden");
         }
         function descativarBotones(boton){
           quitarSeleccion(boton);
           $('#agregarOrd').attr('disabled',true);
         }

         async function CargarTabla(){
           try {
             $('#lotes').hide();
             comenzar('.spinner1');
             const url='RestApi/GET/'+getApi+'?lotes=true';
             var result = await conexion("GET",url,"");
             var parsed =JSON.parse(result);
             if(parsed.length>0){
               var content="";
               for (var i = 0; i < parsed.length; i++) {
                 content+="<tr><td>"+(i+1)+"</td><td>"+parsed[i].Bod+"</td><td>"+parsed[i].Fecha_Li+"</td><td>"+parsed[i].Alcohol+"</td><td>"+parsed[i].Barril+"</td><td>"+parsed[i].Cantidad+"</td><td>"+fomatoNumero(parsed[i].Lts)+"</td></tr>";
               }
               $('#lotes tbody').append(content);
               $('#lotes').show();
             }
             terminar('.spinner1');
           } catch(error) {
             await mensajeError(error);
           }
           Recargar();
         }

         async function CargarDialogo(){
           $("#generarOrdenes > tbody").empty();
           var elements = document.getElementsByClassName("selected");
           if(elements.length>0){
             for (var i = 0; i < elements.length; i++) {
               var eee=elements[i].querySelectorAll('td');
               $('#generarOrdenes').find('tbody').append("<tr><td>"+eee[1].innerHTML+"</td><td>"+eee[2].innerHTML+"</td><td>"+eee[3].innerHTML+"</td><td>"+eee[4].innerHTML+"</td><td><input onchange='maximo(this,"+eee[5].innerHTML+");' type='number' style='max-width: 80px;' value='"+eee[5].innerHTML+"'></input></td></tr>");
             }
             revisarTema();
             generarOrdenes.dialog( "open" );
           }else{
             mensajeError('Selecciona al menos una opción');
           }
         }

         function maximo(valor,max){
           if(valor.value>max){
             mensajeError('No puedes asignar un valor mayor a la cantidad de barriles');
             valor.value=max;
           }else if(valor.value<1){
             mensajeError('Debes asignar al menos un barril');
             valor.value=1;
           }
         }
         var fechaU;
         function ActualizarOrdenes(valor,actualizar){
           if((fechaU!=='' && fechaU!==$('#FOrdenes').val() && $('#FOrdenes').val()!=="") || (valor==='hoy' && $('#FOrdenes').val()!=="") || actualizar){
             fechaU=$('#FOrdenes').val();
             var url='RestApi/GET/'+getApi+'?fechaOrdenes='+fechaU;
             obtenerOrdenesServer(url,"lotesOrden")
           }
         }
         function todasOrdenes(){
           var url='RestApi/GET/'+getApi+'?todasOrdenes=true';
           obtenerOrdenesServer(url,"lotesOrdenTodas")
         }
         async function obtenerOrdenesServer(url,tabla){
           try {
             empezar();
             $("#"+tabla+" > tbody").empty();
             var result = await conexion("GET",url,"");
             url='RestApi/GET/'+getApi+'?operador=';
             var operador = await conexion("GET",url+"3","");//3 son los operadores
             var operadorJ =JSON.parse(operador);
             var montaca = await conexion("GET",url+"4","");//4 son los montacarguistas
             var montacaJ =JSON.parse(montaca);
             var supervisor = await conexion("GET",url+"2","");//2 son los supervisores
             var supervisorJ =JSON.parse(supervisor);
             var cargarTabla =JSON.parse(result);
             for (var i = 0; i < cargarTabla.length; i++) {
               var datos="('"+cargarTabla[i].IdOrden+"','"+cargarTabla[i].Estatus+"',this)";
               var boton=(cargarTabla[i].Estatus==='Por Asignar')?'<button class="btn btn-primary b-r-xl" onclick="Asignacion2'+datos+'" style="margin-right:5px;margin-bottom:5px;">Asignar</button>':'<button class="btn btn-primary b-r-xl" onclick="terminarOrden'+datos+'" style="margin-right:5px;margin-bottom:5px;" '+(cargarTabla[i].Estatus==='Terminada' || cargarTabla[i].Estatus==='Cancelada'?'disabled':'')+'>Terminar</button>';
               //:'<button class="btn btn-primary b-r-xl" style="margin-right:5px;margin-bottom:5px;" disabled>'+cargarTabla[i].Estatus+'</button>';
               var opc=(cargarTabla[i].Estatus!=='Por Asignar')?'disabled':'';
               var botonCancelar=(cargarTabla[i].Estatus==='Por Asignar')?'<button class="btn btn-danger b-r-xl fa fa-trash" onclick="cancelarOrden(\''+cargarTabla[i].IdOrden+'\')"></button>':'';
               $("#"+tabla+" > tbody").append("<tr><td>"+cargarTabla[i].IdOrden+"</td><td>"+cargarTabla[i].Bodega+"</td><td>"+cargarTabla[i].CantBarriles+"</td><td>"+cargarTabla[i].Paletas+"</td>"+escoger(operadorJ,cargarTabla[i].Op,'operador',opc)+escoger(montacaJ,cargarTabla[i].OpeMonta,'montaca',opc)+
               escoger(supervisorJ,cargarTabla[i].Supervidor,'supervisor',opc)+"<td class='Estatus'>"+cargarTabla[i].Estatus+"</td><td>"+boton+botonCancelar+"</td></tr>");
             }
             revisarTema();
             parar();
           } catch(error) {
             await mensajeError(error);
           }
         }

         async function cancelarOrden(idOrden){
           try {
             if(await mensajeOpcional('¿Estás seguro de cancelar la órden '+idOrden+'?')){
               var url='RestApi/POST/'+postApi;
               var params='cancelarOrdenId='+idOrden;
               var result=await conexion("POST", url,params);
               setTimeout(async function() {
                 mensajeSimple(result);
                 ActualizarOrdenes($('#FOrdenes').val(),true);
                 todasOrdenes();
               }, 500);
             }
           } catch (e) {
             setTimeout(async function() {
               mensajeError(e);
             }, 500);
           }
         }

         async function terminarOrden(orden,estatus,boton){
           try {
             if(await mensajeOpcional('¿Estás seguro de terminar la órden '+orden+'?')){
               var url='RestApi/POST/'+postApi;
               var params='terminarOrdenId='+orden;
               var result=await conexion("POST", url,params);
               ActualizarOrdenes($('#FOrdenes').val(),true);
               todasOrdenes();
               setTimeout(async function() {
                 mensajeSimple(result);
                 ActualizarOrdenes($('#FOrdenes').val(),true);
                 todasOrdenes();
               }, 500);
             }
           } catch (e) {
             setTimeout(async function() {
               mensajeError(e);
             }, 500);
           }
         }

         async function Asignacion2(orden,estatus,boton){
           var $row = $(boton).closest("tr");
           var operador=$row.find(".operador").val();
           var maquinista=$row.find(".montaca").val();
           var supervisor=$row.find(".supervisor").val();
           if(operador!=='' && maquinista!=='' && supervisor!=='' && estatus==='Por Asignar' || estatus==='Asignada'){
             try {
               var url='RestApi/POST/'+postApi;
               var params='orden='+orden+'&operador='+operador+'&motaca='+maquinista+'&supervisor='+supervisor;
               await conexion("POST", url,params);
               ActualizarOrdenes($('#FOrdenes').val(),true);
               todasOrdenes();
             } catch (e) {
               mensajeError(e);
             }
           }else{
             mensajeError('Todos los campos deben estar llenados');
           }
         }

         function escoger(operadores,operador,caso,opc){//Se agregan todos los options en cada select de acuerdo al parametro de usuarios que son los operadores
           var content='<td><select class="form-control b-r-xl '+caso+'" '+opc+'><option value=""></option>';
           for (var i = 0; i < operadores.length; i++) {
             if(operadores[i].Nombre===operador){
               content+='<option value="'+operadores[i].Id+'" selected>'+operadores[i].Nombre+'</option>';
             }else{
               content+='<option value="'+operadores[i].Id+'">'+operadores[i].Nombre+'</option>';
             }
           }
           content+='</select></td>';
           return content;
         }

         async function GenerarOrdenes(){
           var l = $('#generarO').ladda();
           l.ladda('start');
           try {
             var envio="data=["
             $("#generarOrdenes > tbody > tr").each(async function () {
               envio+='{"bodega":"'+$(this).find('td').eq(0).text()+'","year":"'+$(this).find('td').eq(1).text()+
               '","Alcohol":"'+$(this).find('td').eq(2).text()+'","Uso":"'+$(this).find('td').eq(3).text()+
               '","Cantidad":"'+$(this).find("td:eq(4) input[type='number']").val()+'"},';
             });
             envio=envio.slice(0,-1);
             envio+="]";
             var url='RestApi/POST/'+postApi;
             var result=await conexion("POST", url,envio);
             await mensajeSimple(result);
             generarOrdenes.dialog( "close" );
             todasOrdenes();
           } catch (e) {
             mensajeError(e);
           }finally{
             l.ladda('stop');
           }
         }


         function Recargar(){
           var table = $('#lotes').DataTable({
             responsive: false,
             "bPaginate": false,
             "paging":   false,
             "ordering": false,
             "info":     false,
             searching: true,
             "language": {
               "emptyTable": "No se encontraron solicitudes",
               searchPlaceholder: "Busca algún dato aquí",
               search: "",
             }
           });
           $('#lotes tbody').on( 'click', 'tr', function (e) {
             var data = table.row( this ).data();
             $(this).toggleClass('selected');
             $(this).children('td').toggleClass('seleccionado');
             var total=lengthSeleccion();
             $('#quitarSel').attr('hidden',total==0);
             $('#agregarOrd').attr('disabled',total==0);
             if(total>0){
               $('#quitarSel').text('Quitar '+total+' seleccionado(s)');
             }
           });
         }

         $(document).ready(function(){
           permisos(["6"]);
           ActualizarFechasLotes('RestApi/GET/'+getApi+'?fechasLotes=true');
           CargarTabla();
           todasOrdenes();
         });
      </script>
   </body>
</html>
