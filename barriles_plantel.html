<!DOCTYPE html>
<html>
   <head>
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <title>Reportes</title>
      <link href="css/jquery.dataTables.min.css" rel="stylesheet">
      <link href="css/bootstrap.min.css" rel="stylesheet">
      <link href="font-awesome/css/font-awesome.css" rel="stylesheet">
      <link rel="icon" href="img\TBRE.ico">
      <link href="css/plugins/dataTables/datatables.min.css" rel="stylesheet">
      <link href="css/animate.css" rel="stylesheet">
      <link href="css/style.css" rel="stylesheet">
      <link href="css/plugins/sweetalert/sweetalert.css" rel="stylesheet">
   </head>
   <body >
      <script src="js/revisar_sesion.js"></script>
      <div id="wrapper">
         <nav class="navbar-default navbar-static-side" role="navigation">
            <div class="sidebar-collapse">
               <ul class="nav metismenu" id="side-menu">
                  <li class="nav-header">
                     <div class="dropdown profile-element">
                        <img alt="image" class="rounded-circle perfil" id="perfil1"/>
                        <a data-toggle="dropdown" class="dropdown-toggle" href="#">
                           <span class="block m-t-xs font-bold">
                              <script>
                                 document.write(localStorage['nombre'] || 'Sin nombre');
                                 var foto=localStorage['nombre'] || 'Sin nombre';
                                 foto=foto.charAt(0).concat(".png").toLowerCase();
                                 document.getElementById("perfil1").src="img/letras/"+foto;
                              </script>
                           </span>
                           <span class="text-muted text-xs block">
                              <script>
                                 document.write(localStorage['perfil'] || 'Sin perfil');
                              </script><b class="caret"></b>
                           </span>
                        </a>
                        <ul class="dropdown-menu animated fadeInRight m-t-xs">
                           <li><a class="dropdown-item" href="perfil.html">Perfil</a></li>
                           <li class="dropdown-divider"></li>
                           <li><a class="dropdown-item" onclick="limpiar();">Cerrar sesión</a></li>
                        </ul>
                     </div>
                     <div class="logo-element">
                        TBRE
                     </div>
                  </li>
                  <li class="once">
                     <a href="index.php"><i class="fa fa-area-chart"></i> <span class="nav-label">Operación del día</span></a>
                  </li>
                  <li class="active diez">
                     <a href="#"><i class="fa fa-table"></i> <span class="nav-label">Reportes</span><span class="fa arrow"></span></a>
                     <ul class="nav nav-second-level">
                       <li><a href="inventario.html">Inventario</a></li>
                       <li class="active"><a href="barriles_plantel.html">Barriles en plantel</a></li>
                       <li><a href="tanques_plantel.html">Tanques en plantel</a></li>
                       <li><a href="llenados.html">Barriles llenados</a></li>
                       <li><a href="rellenados.html">Barriles rellenados</a></li>
                       <li><a href="trasiego.html">Barriles trasegados</a></li>
                       <li><a href="trasiegoHoover.html">T. Hoover llenados</a></li>
                       <li><a href="RGerencia.html">Reporte de Gerencia</a></li>
                     </ul>
                  </li>
                  <li class="dos">
                     <a href="#"><i class="fa fa-desktop"></i> <span class="nav-label">Validar información</span><span class="fa arrow"></span></a>
                     <ul class="nav nav-second-level">
                        <li><a href="VI_barriles.php">Barriles</a></li>
                        <li><a href="VI_hoover.php">Tanques Hoover</a></li>
                     </ul>
                  </li>
                  <li class="cinco">
                     <a href="impresion.html"><i class="fa fa-print"></i> <span class="nav-label">Impresión de etiquetas</span></a>
                  </li>
                  <li class="seis">
                     <a href="#"><i class="fa fa-briefcase"></i> <span class="nav-label">Ordenes de trabajo</span><span class="fa arrow"></span></a>
                     <ul class="nav nav-second-level">
                       <li>
                           <a href="#">Llenado<span class="fa arrow"></span></a>
                           <ul class="nav nav-third-level">
                               <li><a href="OLlenado.html">Orden Llenado</a></li>
                               <li><a href="RLlenadoLlenada.html">Reporte de Llenado</a></li>
                               <li><a href="RLlenadoMantenimineto.html">Reporte de Mantenimiento</a></li>
                               <li><a href="RLlenadoRevisado.html">Reporte de Revisado</a></li>
                           </ul>
                       </li>
                       <li>
                           <a href="#">Relleno<span class="fa arrow"></span></a>
                           <ul class="nav nav-third-level">
                               <li><a href="ORelleno.html">Orden Relleno</a></li>
                               <li><a href="RRellenoOperacion.html">Reporte de Operación</a></li>
                           </ul>
                       </li>
                       <li><a href="revision.html">Revisión</a></li>
                       <li>
                           <a href="#">Trasiego<span class="fa arrow"></span></a>
                           <ul class="nav nav-third-level">
                                <li><a href="OTrasiego.html">Orden Trasiego</a></li>
                                <li><a href="RTrasiegoHojaAnalisis.html">Hoja de Análisis de Trasiego</a></li>
                                <li><a href="RTrasiegoVaciados.html">Barriles vaciados por trasiego</a></li>
                                <li><a href="RTrasiegoRemision.html">Remisión blending</a></li>
                           </ul>
                       </li>
                       <li><a href="OTrasiegoHoover.html">Trasiego Hoover</a></li>
                     </ul>
                  </li>
                  <li class="ocho">
                     <a href="#"><i class="fa fa-inbox"></i> <span class="nav-label">Recepción</span><span class="fa arrow"></span></a>
                     <ul class="nav nav-second-level collapse">
                        <li><a href="RAlcohol.html">Alcohol</a></li>
                        <li><a href="RBarriles.html">Barriles</a></li>
                        <li><a href="RTanquesHoover.html">Tanques Hoover</a></li>
                     </ul>
                  </li>
                  <li class="uno-dos">
                     <a href="#"><i class="fa fa-bell"></i> <span class="nav-label">Solicitudes</span><span class="fa arrow"></span><span class="label label-primary float-right uno" style="margin-right:15px;"id="letrero1">0</span></a>
                     <ul class="nav nav-second-level collapse">
                        <li><a href="pendientes.html">Pendientes <span class="label label-primary float-right uno" id="letrero2">0</span></a></li>
                        <li><a href="aceptadas.html">Aceptadas</a></li>
                        <li><a href="rechazadas.html">Rechazadas</a></li>
                        <li><a href="canceladas.html">Canceladas</a></li>
                     </ul>
                  </li>
                  <li class="siete">
                     <a href="disenoAlmacen.html"><i class="fa fa-building"></i> <span class="nav-label">Diseñar almacenes</span></a>
                  </li>
                  <li class="nueve">
                     <a href="AjustesInventario.html"><i class="fa fa-edit"></i> <span class="nav-label">Ajustes de inventario</span></a>
                  </li>
                  <li class="tres-cuatro">
                     <a href="#"><i class="fa fa-gear"></i> <span class="nav-label">Administración</span><span class="fa arrow"></span></a>
                     <ul class="nav nav-second-level">
                        <li class="tres"><a href="usuarios.html">Usuarios</a></li>
                        <li class="cuatro"><a href="configuracion.html">Configuración</a></li>
                     </ul>
                  </li>
               </ul>
            </div>
         </nav>
         <div id="page-wrapper" class="gray-bg">
            <div class="row border-bottom">
               <nav class="navbar navbar-static-top" role="navigation" style="margin-bottom: 0">
                  <div class="navbar-header">
                     <a class="navbar-minimalize minimalize-styl-2 btn btn-primary " href="#"><i class="fa fa-bars"></i> </a>
                  </div>
                  <h2 class="nav navbar-top-links titulo welcome-message">Inventario de barriles vacios en plantel</h2>
                  <ul class="nav navbar-top-links navbar-right">
                     <li class="dropdown uno">
                        <a class="dropdown-toggle count-info" data-toggle="dropdown" href="#">
                        <i class="fa fa-bell"></i>  <span class="label label-primary" id="letrero3">0</span>
                        </a>
                        <ul class="dropdown-menu dropdown-alerts">
                           <li>
                              <a href="pendientes.html" class="dropdown-item">
                                 <div id="letrero4">
                                    <i class="fa fa-envelope fa-fw" ></i> Tienes 0 solicitudes de cambios
                                 </div>
                              </a>
                           </li>
                        </ul>
                     </li>
                     <li>
                        <a onclick="javascript:limpiar();">
                        <i class="fa fa-sign-out"></i> Cerrar sesión
                        </a>
                     </li>
                  </ul>
               </nav>
            </div>
            <div class="row wrapper border-bottom white-bg page-heading" >
               <div class="col-md-12">
                 <div class="table-responsive col-md-12">
                   <div class="sk-spinner spinner1">
                      <div class="sk-bounce1"></div>
                      <div class="sk-bounce2"></div>
                      <div class="sk-bounce3"></div>
                   </div>
                   <h3 style="margin-top:20px;margin-left:10px;" id="edad">Edades</h3>
                   <table class="table table-striped table-bordered table-hover" id="tabla1">
                     <thead></thead>
                   </table>
                 </div>
                 <div class="col-md-12 d-flex justify-content-center table-responsive text-center">
                   <div class="table-responsive col-md-10 centro">
                     <table class="table table-striped table-bordered table-hover funciones" id="tabla2" >
                       <thead>
                         <tr>
                         <th style="text-align: center;">Número</th>
                         <th style="text-align: center;">Plantel</th>
                         <th style="text-align: center;">Uso</th>
                         <th style="text-align: center;">A</th>
                         <th style="text-align: center;">B</th>
                         <th style="text-align: center;">C</th>
                         <th style="text-align: center;">D</th>
                         <th style="text-align: center;">F</th>
                         <th style="text-align: center;">RC</th>
                         <th style="text-align: center;">RF</th>
                         <th style="text-align: center;">Total</th>
                         </tr>
                       </thead>
                       <tbody></tbody>
                       <tfoot>
                         <tr>
                           <th></th><th></th><th></th>
                           <th style="text-align: right;"></th>
                           <th style="text-align: right;"></th>
                           <th style="text-align: right;"></th>
                           <th style="text-align: right;"></th>
                           <th style="text-align: right;"></th>
                           <th style="text-align: right;"></th>
                           <th style="text-align: right;"></th>
                           <th style="text-align: right;"></th>
                         </tr>
                       </tfoot>
                     </table>
                   </div>
                 </div>
               </div>
            </div>
            <a href="#" class="aDes floatDes btnDes" id="menu-share">
              <i class="fa fa-download my-float"></i>
            </a>
            <ul class="ulDes">
              <li><a href="javascript:generar('jpg','foto');" class="btnDes aDes">
                <i class="fa fa-file-image-o my-float" id="foto"></i>
                <div class="label-container">
                  <div class="label-text">JPG</div>
                  <i class="fa fa-play label-arrow"></i>
                </div>
              </a></li>
              <li><a href="javascript:generar('pdf','pdf');" class="btnDes aDes">
                <i class="fa fa-file-pdf-o my-float" id="pdf"></i>
                <div class="label-container">
                  <div class="label-text">PDF</div>
                  <i class="fa fa-play label-arrow"></i>
                </div>
              </a></li>
              <li><a href="javascript:generar('xlsx','excel');" class="btnDes aDes" >
                <i class="fa fa-file-excel-o my-float" id="excel"></i>
                <div class="label-container">
                  <div class="label-text">Excel</div>
                  <i class="fa fa-play label-arrow"></i>
                </div>
              </a></li>
            </ul>
            <div class="footer">
               <div>
                  <strong>Todos los derechos reservados | </strong>SER Licorera 2014
               </div>
            </div>
         </div>
      </div>
      <!-- Mainly scripts -->
      <script src="js/jquery-3.1.1.min.js"></script>
      <script src="js/popper.min.js"></script>
      <script src="js/bootstrap.js"></script>
      <script src="js/bootstrap-waitingfor.js"></script>
      <script src="js/plugins/sweetalert/sweetalert.min.js"></script>
      <script src="js/plugins/metisMenu/jquery.metisMenu.js"></script>
      <script src="js/plugins/slimscroll/jquery.slimscroll.min.js"></script>
      <script src="js/plugins/dataTables/datatables.min.js"></script>
      <script src="js/plugins/dataTables/dataTables.bootstrap4.min.js"></script>
      <script src="js/plugins/ladda/spin.min.js"></script>
      <script src="js/plugins/ladda/ladda.min.js"></script>
      <script src="js/plugins/ladda/ladda.jquery.min.js"></script>
      <!-- Custom and plugin javascript -->
      <script src="js/inspinia.js"></script>
      <script src="js/plugins/pace/pace.min.js"></script>
      <script src="js/funciones_generales.js"></script>
      <script src="js/abrir_ventana.js"></script>
      <script>
        const getApi="get_Reportes.php";

        async function cargarDatos(){
          try {
            empezar();
            var url='RestApi/GET/'+getApi+'?barriles_plantel=true';
            var result = await conexion("GET",url,"");
            var parsed =JSON.parse(result);
            var content="";
            if(parsed.length>0){
              var aut=btoa(localStorage['usuario'] + ":" + localStorage['password']);
              for (var i = 0; i < parsed.length; i++) {
                content+='<tr><td style="text-align: center;color:blue;text-decoration: underline;"><a onclick="javascript:abrir(\'descripcion_bodegas.php?tipo=barriles&almacen='+parsed[i].AlmacenId+'&area='+parsed[i].AreaId+'&codificacion='+parsed[i].IdCodificacion+'&aut='+aut+'\')">'+parsed[i].Num+'</a></td>'+
                "</td><td>"+parsed[i].Plantel+"</td><td>"+parsed[i].Uso+"</td><td style='text-align: right;'>"+parsed[i].A+
                "</td><td style='text-align: right;'>"+parsed[i].B+"</td></td><td style='text-align: right;'>"+parsed[i].C+
                "</td></td><td style='text-align: right;'>"+parsed[i].D+"</td></td><td style='text-align: right;'>"+parsed[i].F+
                "</td></td><td style='text-align: right;'>"+parsed[i].RC+"</td></td><td style='text-align: right;'>"+parsed[i].RF+
                "</td><td style='text-align: right;'>"+parsed[i].Total+"</td></tr>";
              }
              $('#tabla2 tbody').append(content);
              setTimeout(function() {
                recargarTablas();
              }, 500);
            }else{
              limpiarDatos();
            }
          } catch(error) {
            await mensajeError(error);
          }finally {
            //parar();
          }
        }


         async function cargarEdades(){
            try {
              var url='RestApi/GET/'+getApi+'?edades=true';
              var result = await conexion("GET",url,"");
              var parsed =JSON.parse(result);
              var content="<tr>";
              for (var i = 1; i <= 7; i++) {
                content+='<th>'+parsed[0]['Camp'+i]+'</th>';
              }
              content+='</tr>';
              $('#tabla1 thead').append(content);
            } catch (e) {
              mensajeError(e);
            }
          }

          async function generar(tipo,boton){
            if($('#tabla2 tbody td').length>0){
              var l = $('#'+boton).ladda();
              try {
                l.ladda('start');
                var url=getNode+"?reporte=barriles_plantel&tipo="+tipo;
                var valor=await conexion("GET",url,"");
                let link = document.createElement("a");
                link.download = "Reporte de Barriles por plantel ."+tipo;
                link.href = valor;
                link.click();
              } catch (e) {
                mensajeError(e);
              } finally {
                l.ladda('stop');
              }
            }else{
              mensajeError("No hay datos que exportar");
            }
          }

          function recargarTablas(){

            $('#tabla2').DataTable( {"footerCallback": function ( row, data, start, end, display ) {
              var api = this.api(), data;

              // Remove the formatting to get integer data for summation
              var intVal = function ( i ) {
                  return typeof i === 'string' ?
                      i.replace(/[\$,]/g, '')*1 :
                      typeof i === 'number' ?
                          i : 0;
              };
              a = api.column( 3, { page: 'current'} ).data().reduce( function (a, b) {
                  return intVal(a) + intVal(b);
              }, 0 );
              b= api.column( 4, { page: 'current'} ).data().reduce( function (a, b) {
                  return intVal(a) + intVal(b);
              }, 0 );
              c = api.column( 5, { page: 'current'} ).data().reduce( function (a, b) {
                  return intVal(a) + intVal(b);
              }, 0 );
              d= api.column( 6, { page: 'current'} ).data().reduce( function (a, b) {
                  return intVal(a) + intVal(b);
              }, 0 );
              rc = api.column( 7, { page: 'current'} ).data().reduce( function (a, b) {
                  return intVal(a) + intVal(b);
              }, 0 );
              e= api.column( 8, { page: 'current'} ).data().reduce( function (a, b) {
                  return intVal(a) + intVal(b);
              }, 0 );
              f = api.column( 9, { page: 'current'} ).data().reduce( function (a, b) {
                  return intVal(a) + intVal(b);
              }, 0 );
              totalbarriles= api.column( 10, { page: 'current'} ).data().reduce( function (a, b) {
                  return intVal(a) + intVal(b);
              }, 0 );
              // Update footer
              $( api.column(3).footer() ).html(a.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ","));
              $( api.column(4).footer() ).html(b.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ","));
              $( api.column(5).footer() ).html(c.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ","));
              $( api.column(6).footer() ).html(d.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ","));
              $( api.column(7).footer() ).html(rc.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ","));
              $( api.column(8).footer() ).html(e.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ","));
              $( api.column(9).footer() ).html(f.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ","));
              $( api.column(10).footer() ).html(totalbarriles.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ","));
          },
          responsive: true,
          "bPaginate": false,
          "paging":   false,
          "ordering": false,
          "info":     false,
          dom: '<"html5buttons"B>lTfgitp',
          language: {
            searchPlaceholder: "Busca algún dato aquí",
            search: "",
          },
          buttons: [{ extend: 'copy',text:'Copiar'}]
        } );
          }

         $(document).ready(function(){
           permisos(["10"]);
           cargarDatos();
           cargarEdades();
         });


      </script>
   </body>
</html>
